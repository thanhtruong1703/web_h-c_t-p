<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>·ª®ng D·ª•ng Tr·∫Øc Nghi·ªám T·ª± Nh·∫≠p</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mammoth/1.4.2/mammoth.browser.min.js"></script>
    <style>
        /* Th√™m c√°c style n√†y ƒë·ªÉ ·∫©n c√°c ph·∫ßn kh√¥ng c·∫ßn thi·∫øt */
        #fileInputSection, 
        #manualQuestionSection,
        #addedQuestionsContainer {
            display: none !important;
        }

        /* Ph·∫ßn c√≤n l·∫°i gi·ªØ nguy√™n */
        .button-container {
            position: fixed;
            bottom: 20px;
            right: 20px;
            display: flex;
            gap: 10px;
            z-index: 1000;
            background-color: white;
            padding: 10px;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        .btn-submit {
            background-color: #dc3545;
            color: white;
            font-size: 18px;
            font-weight: bold;
            padding: 10px 20px;
            border-radius: 5px;
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 1000;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        }

        .btn-submit:hover {
            background-color: #218838;
            cursor: pointer;
        }

        .btn-back {
            background-color: #007bff;
            color: white;
            font-size: 18px;
            font-weight: bold;
            padding: 10px 20px;
            border-radius: 5px;
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 1000;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            display: none;
        }

        .btn-back:hover {
            background-color: #0056b3;
            cursor: pointer;
        }

        .question-container {
            margin-bottom: 15px;
        }

        #quizContent {
            display: none;
        }

        .result-message {
            font-size: 20px;
            font-weight: bold;
            margin-top: 20px;
        }

        .btn-start {
            position: absolute;
            font-size: 18px;
            padding: 10px 20px;
            border-radius: 5px;
            z-index: 1000;
            background-color: #3355ff !important;
            color: white;
            font-weight: bold;
            border: 2px solid #1d3acc;
            box-shadow: 2px 2px 5px rgba(0, 0, 0, 0.3);
            top: 20px;
            right: 20px;
            cursor: pointer
        }
        .btn-start:disabled {
            background-color: #3355ff !important;
            color: white !important;
            opacity: 1 !important;
        }
        .back-button {
            position: absolute;
            font-size: 18px;
            padding: 10px 20px;
            border-radius: 5px;
            z-index: 1000;
            background-color: #3355ff !important;
            color: white;
            font-weight: bold;
            border: 2px solid #1d3acc;
            box-shadow: 2px 2px 5px rgba(0, 0, 0, 0.3);
            top: 20px;
            right: 135px;
            cursor: pointer;
        }

        .btn-start:hover {
            background-color:#3355ff;
            cursor: pointer;
        }

        .back-button:hover {
            background-color: #3355ff;
            cursor: pointer;
        }

        #scoreDisplayTop {
            position: fixed;
            top: 20px;
            left: 20px;
            z-index: 1000;
            font-size: 18px;
            background-color: #f8f9fa;
            padding: 10px;
            border-radius: 5px;
            display: none;
        }

        .alert {
            color: rgba(236, 25, 25, 0.919);
            font-weight: bold;
        }

        .incorrect {
            color: rgba(255, 0, 0, 0.984);
        }

        .correct {
            color: rgb(0, 110, 255);
        }

        /* L√†m cho checkbox to h∆°n */
        input[type="checkbox"] {
            width: 25px;
            height: 25px;
            margin-right: 10px;
        }

        /* Style cho n√∫t t·∫£i xu·ªëng b·ªã v√¥ hi·ªáu h√≥a */
        .disabled-button {
            background-color: #cccccc !important;
            color: #666666 !important;
            cursor: not-allowed !important;
            pointer-events: none !important;
            border: 1px solid #999999 !important;
        }

        /* Style cho danh s√°ch file */
        #fileList table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }

        #fileList th, #fileList td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }

        #fileList th {
            background-color: #f2f2f2;
        }

        #fileList tr:hover {
            background-color: #f5f5f5;
        }

        .file-name {
            color: blue;
            text-decoration: underline;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <div class="container mt-5">
        <div class="quiz-container">
            <h1 class="text-center">ƒê·ªÄ THI TR·∫ÆC NGHI·ªÜM</h1>
            
            <!-- Ch·ªâ gi·ªØ l·∫°i ph·∫ßn hi·ªÉn th·ªã file ƒë√£ l∆∞u -->
            <div id="fileListSection" class="mt-4">
                <button type="button" class="btn btn-info" onclick="toggleFileList()">DANH S√ÅCH B√ÄI T·∫¨P</button>
                <ul id="fileList" class="mt-3"></ul>
            </div>

            <!-- ·∫®n c√°c ph·∫ßn kh√¥ng c·∫ßn thi·∫øt -->
            <div id="fileInputSection" class="mb-4" style="display: none;">
                <label for="fileInput" class="form-label">Ch·ªçn File Word:</label>
                <input type="file" id="fileInput" class="form-control" accept=".docx">
                <br>
                <button type="button" class="btn btn-primary" onclick="saveFileToIndexedDB()">L∆∞u File</button>
                <div id="fileUploadFeedback" class="mt-3"></div>
            </div>

            <div id="feedback" class="mt-4 text-center"></div>

            <!-- ·∫®n ph·∫ßn nh·∫≠p c√¢u h·ªèi th·ªß c√¥ng -->
            <div id="manualQuestionSection" class="mb-4" style="display: none;">      
                <form id="add-question-form">
                    <!-- N·ªôi dung form t·∫°o c√¢u h·ªèi -->
                </form>
            </div>

            <div id="addedQuestionsContainer" class="mt-4" style="display: none;">
                <!-- Hi·ªÉn th·ªã c√°c c√¢u h·ªèi ƒë√£ th√™m -->
            </div>

            <div id="quizContent" class="mt-4">
                <!-- N·ªôi dung c√¢u h·ªèi th√™m ·ªü ƒë√¢y -->
            </div>

            <button id="startBtn" class="btn btn-start" onclick="startQuiz()" disabled>L√†m B√†i</button>
            <button id="submitBtn" class="btn btn-submit" onclick="submitQuiz()" style="display: none;">N·ªôp B√†i</button>
            <button id="backBtn" class="btn btn-back" onclick="backToStart()">Quay L·∫°i</button>
            <button class="back-button" id="back" onclick="goBack()">Quay l·∫°i</button>
            <div id="scoreDisplayTop">
                ƒêi·ªÉm s·ªë: <span id="scoreValueTop"></span>
            </div>

            <div id="resultSection" class="result-message" style="display: none;"></div>
        </div>
    </div>

    <script>
        // T·∫°o l∆∞u tr·ªØ
        let db;
        let isFileLoaded = false;
        let questions = [];
        let correctAnswers = [];
        let userlocal = JSON.parse(localStorage.getItem("userlogin")) || [];

        // H√†m m·ªü IndexedDB
        function openDB(callback) {
            if (db) {
                callback();
                return;
            }

            const request = indexedDB.open("FileStorageDB", 4);

            request.onupgradeneeded = function (event) {
                db = event.target.result;

                if (!db.objectStoreNames.contains("dsfiles")) {
                    db.createObjectStore("dsfiles", { keyPath: "id" });
                }

                if (!db.objectStoreNames.contains("files")) {
                    db.createObjectStore("files", { keyPath: "id" });
                }

                if (!db.objectStoreNames.contains("tlnfiles")) {
                    db.createObjectStore("tlnfiles", { keyPath: "id" });
                }

                if (!db.objectStoreNames.contains("rank")) {
                    const rankStore = db.createObjectStore("rank", { keyPath: "name" });
                    rankStore.createIndex("score", "score", { unique: false });
                }
            };

            request.onsuccess = function (event) {
                db = event.target.result;
                callback();
            };

            request.onerror = function (event) {
                console.error("‚ùå L·ªói m·ªü IndexedDB:", event.target.error);
            };
        }

        // H√†m hi·ªÉn th·ªã danh s√°ch file
        function toggleFileList() {
            const fileList = document.getElementById("fileList");
            
            if (!fileList) {
                console.error("Ph·∫ßn t·ª≠ fileList kh√¥ng t·ªìn t·∫°i. Vui l√≤ng ki·ªÉm tra l·∫°i ID c·ªßa ph·∫ßn t·ª≠ n√†y.");
                return;
            }
        
            if (fileList.style.display === "none" || fileList.style.display === "")  {
                fileList.style.display = "block";
                listAllFiles();
            } else {
                fileList.style.display = "none";
            }
        }

        function listAllFiles() {
            openDB(() => {
                const transaction = db.transaction(["dsfiles"], "readonly");
                const store = transaction.objectStore("dsfiles");
                const request = store.getAll();
        
                request.onsuccess = function (event) {
                    const files = event.target.result;
                    const fileList = document.getElementById("fileList");
                    fileList.innerHTML = "";
        
                    if (files.length > 0) {
                        // T·∫°o b·∫£ng ƒë·ªÉ hi·ªÉn th·ªã danh s√°ch file
                        const table = document.createElement("table");
                        
                        // T·∫°o ti√™u ƒë·ªÅ b·∫£ng
                        const thead = document.createElement("thead");
                        thead.innerHTML = `
                            <tr>
                                <th>üìÑ T√™n File</th>
                                <th style="text-align: center;">üì• T·∫£i Xu·ªëng</th>
                                <th style="text-align: center;">‚ùå X√≥a</th>
                            </tr>
                        `;
                        table.appendChild(thead);
        
                        // T·∫°o ph·∫ßn th√¢n b·∫£ng
                        const tbody = document.createElement("tbody");
        
                        files.forEach(file => {
                            const row = document.createElement("tr");
        
                            // √î t√™n file
                            const fileNameCell = document.createElement("td");
                            const fileNameSpan = document.createElement("span");
                            fileNameSpan.textContent = file.name;
                            fileNameSpan.className = "file-name";
                            fileNameSpan.onclick = function () {
                                loadFileForQuiz(file.id);
                            };
                            fileNameCell.appendChild(fileNameSpan);
                            
                            // √î n√∫t t·∫£i xu·ªëng (b·ªã v√¥ hi·ªáu h√≥a)
                            const downloadCell = document.createElement("td");
                            downloadCell.style.textAlign = "center";
                            
                            const downloadBtn = document.createElement("button");
                            downloadBtn.textContent = "üì• T·∫£i xu·ªëng";
                            downloadBtn.className = "disabled-button";
                            downloadCell.appendChild(downloadBtn);
        
                            // √î n√∫t x√≥a (b·ªã v√¥ hi·ªáu h√≥a)
                            const deleteCell = document.createElement("td");
                            deleteCell.style.textAlign = "center";
                            
                            const deleteBtn = document.createElement("button");
                            deleteBtn.textContent = "‚ùå X√≥a";
                            deleteBtn.className = "disabled-button";
                            deleteCell.appendChild(deleteBtn);
        
                            // Th√™m c√°c √¥ v√†o h√†ng
                            row.appendChild(fileNameCell);
                            row.appendChild(downloadCell);
                            row.appendChild(deleteCell);
        
                            // Th√™m h√†ng v√†o tbody
                            tbody.appendChild(row);
                        });
        
                        table.appendChild(tbody);
                        fileList.appendChild(table);
                    } else {
                        fileList.innerHTML = "<p style='text-align:center;'>Kh√¥ng c√≥ file n√†o trong kho l∆∞u tr·ªØ</p>";
                    }
                };
        
                request.onerror = function () {
                    alert("L·ªói khi truy c·∫≠p danh s√°ch file!");
                };
            });
        }

        // H√†m t·∫£i file ƒë·ªÉ l√†m b√†i
        function loadFileForQuiz(fileId) {
            openDB(() => {
                const transaction = db.transaction(["dsfiles"], "readonly");
                const store = transaction.objectStore("dsfiles");
                const request = store.get(fileId);
        
                request.onsuccess = function (event) {
                    const file = event.target.result;
                    if (file) {
                        mammoth.extractRawText({ arrayBuffer: base64ToArrayBuffer(file.content.split(",")[1]) })
                            .then(function(output) {
                                parseQuestions(output.value);
                                isFileLoaded = true;
                                updateStartButtonState();
                                startQuiz();
                            })
                            .catch(function(err) {
                                alert("Kh√¥ng th·ªÉ ƒë·ªçc file tr·∫Øc nghi·ªám.");
                                console.error(err);
                            });
                    } else {
                        alert("Kh√¥ng t√¨m th·∫•y file!");
                    }
                };
        
                request.onerror = function () {
                    alert("L·ªói khi truy xu·∫•t file!");
                };
            });
        }

        // Chuy·ªÉn Base64 v·ªÅ ArrayBuffer ƒë·ªÉ ƒë·ªçc file Word
        function base64ToArrayBuffer(base64) {
            const binaryString = window.atob(base64);
            const len = binaryString.length;
            const bytes = new Uint8Array(len);
            for (let i = 0; i < len; i++) {
                bytes[i] = binaryString.charCodeAt(i);
            }
            return bytes.buffer;
        }

        //// ranker
        function saveRank(name, newScore) {
            openDB(() => {
                const transaction = db.transaction(["rank"], "readwrite");
                const store = transaction.objectStore("rank");
        
                const request = store.get(name);
        
                request.onsuccess = function () {
                    const existingEntry = request.result;
        
                    if (existingEntry) {
                        // C·ªông d·ªìn ƒëi·ªÉm s·ªë m·ªõi v√†o ƒëi·ªÉm s·ªë c≈©
                        existingEntry.score += parseFloat(newScore);
        
                        const updateRequest = store.put(existingEntry);
                        updateRequest.onsuccess = function () {
                            console.log(`Score updated successfully! New total score: ${existingEntry.score}`);
                        };
                        updateRequest.onerror = function () {
                            console.error("Error updating score");
                        };
                    } else {
                        // N·∫øu ch∆∞a c√≥ d·ªØ li·ªáu, th√™m m·ªõi
                        const newEntry = { name: name, score: parseFloat(newScore) };
                        const addRequest = store.add(newEntry);
        
                        addRequest.onsuccess = function () {
                            console.log("New rank data added successfully!");
                        };
                        addRequest.onerror = function () {
                            console.error("Error adding new rank data");
                        };
                    }
                };
        
                request.onerror = function () {
                    console.error("Error checking existing entry");
                };
            });
        }

        // H√†m ki·ªÉm tra v√† c·∫≠p nh·∫≠t tr·∫°ng th√°i n√∫t "L√†m b√†i"
        function updateStartButtonState() {
            const startBtn = document.getElementById('startBtn');
            if (questions.length > 0 || isFileLoaded) {
                startBtn.disabled = false;
            } else {
                startBtn.disabled = true;
            }
        }

        // H√†m ph√¢n t√≠ch c√¢u h·ªèi v√† ƒë√°p √°n t·ª´ file Word
        function parseQuestions(text) {
            const lines = text.split('\n');
            questions = [];
            let currentQuestion = null;
            let isValidFormat = true;
        
            lines.forEach(line => {
                if (line.startsWith('C√¢u h·ªèi:')) {
                    if (currentQuestion) {
                        questions.push(currentQuestion);
                    }
                    currentQuestion = { 
                        question: line.replace('C√¢u h·ªèi:', '').trim(), 
                        options: {}, 
                        correctOptions: { correct: [], incorrect: [] } 
                    };
                } else if (line.startsWith('A:')) {
                    currentQuestion.options.A = line.replace('A:', '').trim();
                } else if (line.startsWith('B:')) {
                    currentQuestion.options.B = line.replace('B:', '').trim();
                } else if (line.startsWith('C:')) {
                    currentQuestion.options.C = line.replace('C:', '').trim();
                } else if (line.startsWith('D:')) {
                    currentQuestion.options.D = line.replace('D:', '').trim();
                } else if (line.startsWith('ƒê√°p √°n ƒë√∫ng:')) {
                    const correctAnswers = line.replace('ƒê√°p √°n ƒë√∫ng:', '').trim().split(',').map(answer => answer.trim());
                    currentQuestion.correctOptions.correct = correctAnswers;
        
                    const allOptions = ['A', 'B', 'C', 'D'];
                    currentQuestion.correctOptions.incorrect = allOptions.filter(option => !correctAnswers.includes(option));
                } else if (line.trim() !== '') {
                    isValidFormat = false;
                }
        
                isFileLoaded = true;
                updateStartButtonState();
            });
        
            if (currentQuestion) {
                questions.push(currentQuestion);
            }
        
            if (!isValidFormat || questions.length === 0) {
                alert("ƒê·ªãnh d·∫°ng file kh√¥ng ƒë√∫ng. Vui l√≤ng ki·ªÉm tra l·∫°i.");
                document.getElementById('startBtn').disabled = true;
            }
        }

        function startQuiz() {
            document.getElementById('fileListSection').style.display = 'none';
            document.getElementById('back').style.display = 'none';
            document.getElementById('quizContent').style.display = 'block';

            const quizContent = document.getElementById('quizContent');
            quizContent.innerHTML = '';
            questions.forEach((q, index) => {
                const optionsArray = [
                    { key: 'A', value: q.options.A },
                    { key: 'B', value: q.options.B },
                    { key: 'C', value: q.options.C },
                    { key: 'D', value: q.options.D }
                ];

                let questionHTML = `
                    <div class="question-container">
                        <p><strong>C√¢u h·ªèi ${index + 1}: ${q.question}</strong></p>
                `;

                optionsArray.forEach(option => {
                    questionHTML += `
                        <div>
                            <input type="checkbox" name="question${index}_${option.key}" value="${option.key}"> ${option.key}. ${option.value}
                        </div>
                    `;
                });

                questionHTML += '</div>';
                quizContent.innerHTML += questionHTML;
            });

            document.getElementById('submitBtn').style.display = 'inline-block';
            document.getElementById('startBtn').style.display = 'none';
        }

        function goBack() {
            window.history.back();
        }

        function countUnselectedIncorrectAnswers(incorrectOptions, selectedAnswers) {
            let unselectedIncorrectCount = 0;
        
            incorrectOptions.forEach(option => {
                if (!selectedAnswers.includes(option)) {
                    unselectedIncorrectCount++;
                }
            });
        
            return unselectedIncorrectCount;
        }

        function submitQuiz() {
            let totalQuestions = questions.length;
            let pointsPerQuestion = 10 / totalQuestions;
            let earnedPoints = 0;
            let correctCount = 0;
            let incorrectCount = 0;
            let unselectedIncorrectCount = 0; // Khai b√°o bi·∫øn unselectedIncorrectCount ·ªü ƒë√¢y
        
            questions.forEach((q, index) => {
                const correctOptions = q.correctOptions.correct; // L·∫•y c√°c ƒë√°p √°n ƒë√∫ng
                const incorrectOptions = q.correctOptions.incorrect; // L·∫•y c√°c ƒë√°p √°n sai
                const selectedAnswers = []; // ƒê√°p √°n ng∆∞·ªùi d√πng ch·ªçn

                // L·∫•y c√°c ƒë√°p √°n ng∆∞·ªùi d√πng ƒë√£ ch·ªçn
                Object.keys(q.options).forEach(optionKey => {
                    const checkboxes = document.querySelectorAll(`input[name="question${index}_${optionKey}"]:checked`);
                    checkboxes.forEach(checkbox => {
                        selectedAnswers.push(checkbox.value);
                    });
                });
        
                // T√≠nh s·ªë ƒë√°p √°n ƒë√∫ng m√† ng∆∞·ªùi d√πng ch·ªçn
                let correctSelected = 0;
                correctOptions.forEach(answer => {
                    if (selectedAnswers.includes(answer)) {
                        correctSelected++;
                    }
                });

                unselectedIncorrectCount=0;
                // T√≠nh s·ªë ƒë√°p √°n sai m√† ng∆∞·ªùi d√πng ch·ªçn
                let incorrectSelected = 0;
                incorrectOptions.forEach(answer => {
                    if (selectedAnswers.includes(answer)) {
                        incorrectSelected++;
                    }
                });
        
                // T√≠nh s·ªë ƒë√°p √°n sai m√† ng∆∞·ªùi d√πng kh√¥ng ch·ªçn
                unselectedIncorrectCount += countUnselectedIncorrectAnswers(incorrectOptions, selectedAnswers);
        
                // T√≠nh ƒëi·ªÉm cho c√¢u h·ªèi d·ª±a tr√™n s·ªë ƒë√°p √°n ƒë√∫ng
                let questionScore = 0;
                if (correctSelected + unselectedIncorrectCount === 4) {
                    questionScore = pointsPerQuestion; // 100% ƒëi·ªÉm n·∫øu ƒë√∫ng t·∫•t c·∫£
                } else if (correctSelected + unselectedIncorrectCount === 3) {
                    questionScore = pointsPerQuestion * 0.5; // 50% ƒëi·ªÉm n·∫øu ƒë√∫ng 3/4
                } else if (correctSelected + unselectedIncorrectCount === 2) {
                    questionScore = pointsPerQuestion * 0.25; // 25% ƒëi·ªÉm n·∫øu ƒë√∫ng 2/4
                } else if (correctSelected + unselectedIncorrectCount=== 1) {
                    questionScore = pointsPerQuestion * 0.1; // 10% ƒëi·ªÉm n·∫øu ƒë√∫ng 1/4
                } else {
                    questionScore = 0; // 0% ƒëi·ªÉm n·∫øu kh√¥ng ƒë√∫ng c√¢u n√†o
                }
        
                // C·ªông ƒëi·ªÉm v√†o t·ªïng ƒëi·ªÉm
                earnedPoints += questionScore;
        
                // ƒê·∫øm s·ªë c√¢u ƒë√∫ng/sai
                if (correctSelected > 0) {
                    correctCount++;
                } else {
                    incorrectCount++;
                }
        
                // ƒê√°nh d·∫•u ƒë√∫ng/sai tr√™n giao di·ªán
                Object.keys(q.options).forEach(optionKey => {
                    const parentDiv = document.querySelector(`input[name="question${index}_${optionKey}"]`).parentElement;
                    if (correctOptions.includes(optionKey)) {
                        parentDiv.classList.add('correct');
                    } else if (selectedAnswers.includes(optionKey)) {
                        parentDiv.classList.add('incorrect');
                    }
                });
            });
        
            // ƒê·∫£m b·∫£o t·ªïng ƒëi·ªÉm kh√¥ng v∆∞·ª£t qu√° 10 ho·∫∑c nh·ªè h∆°n 0
            if (earnedPoints > 10) {
                earnedPoints = 10; // N·∫øu t·ªïng ƒëi·ªÉm v∆∞·ª£t qu√° 10, g√°n l·∫°i b·∫±ng 10
            } else if (earnedPoints < 0) {
                earnedPoints = 0; // N·∫øu t·ªïng ƒëi·ªÉm nh·ªè h∆°n 0, g√°n l·∫°i b·∫±ng 0
            }
        
            // V√¥ hi·ªáu h√≥a t·∫•t c·∫£ c√°c √¥ ch·ªçn ƒë√°p √°n
            document.querySelectorAll('input[type="checkbox"]').forEach(checkbox => {
                checkbox.disabled = true;
            });
        
            // Hi·ªÉn th·ªã ƒëi·ªÉm s·ªë
            document.getElementById('scoreValueTop').innerText = earnedPoints.toFixed(1);
            document.getElementById('scoreDisplayTop').style.display = 'block';
        
            // Hi·ªÉn th·ªã k·∫øt qu·∫£ chi ti·∫øt
            const resultMessage = document.getElementById('resultSection');
            resultMessage.style.display = 'block';
            resultMessage.innerHTML = `
                ƒêi·ªÉm c·ªßa b·∫°n l√†: ${earnedPoints.toFixed(1)} / 10.
            `;
        
            // ·∫®n n√∫t "N·ªôp b√†i" v√† hi·ªÉn th·ªã n√∫t "Quay l·∫°i"
            document.getElementById('submitBtn').style.display = 'none';
            document.getElementById('backBtn').style.display = 'inline-block';
        
            // L∆∞u ƒëi·ªÉm v√†o b·∫£ng x·∫øp h·∫°ng
            saveRank(userlocal.name, earnedPoints.toFixed(1));
        }

        function backToStart() {
            questions = [];
            correctAnswers = [];
            isFileLoaded = false;
        
            document.getElementById('fileListSection').style.display = 'block';
            document.getElementById('back').style.display = 'block';
            document.getElementById('quizContent').innerHTML = '';
            document.getElementById('submitBtn').style.display = 'none';
            document.getElementById('startBtn').style.display = 'inline-block';
            document.getElementById('backBtn').style.display = 'none';
            document.getElementById('scoreDisplayTop').style.display = 'none';
            document.getElementById('resultSection').style.display = 'none';
            document.getElementById('fileList').style.display = 'none';
        
            document.querySelectorAll('input[type="checkbox"]').forEach(checkbox => {
                checkbox.checked = false;
                checkbox.disabled = false;
                checkbox.parentElement.classList.remove('correct', 'incorrect');
            });
        
            updateStartButtonState();
        }

        // V√¥ hi·ªáu h√≥a c√°c h√†m kh√¥ng c·∫ßn thi·∫øt
        function saveFileToIndexedDB() {}
        function toggleCorrectAnswer() {}
        function toggleAddQuestionButton() {}
        function addQuestion() {}
    </script>
</body>
</html>